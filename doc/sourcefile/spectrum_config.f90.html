<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
    <meta name="description" content="Documentation for Fortran Program">
	 
    <meta name="author" content="Chris MacMackin" >
    <link rel="icon" href="../favicon.png">

    <title>spectrum_config.f90 &ndash; Fortran Program</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran Program </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
                
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
				
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            <li><a href="../lists/programs.html">Programs</a></li>
				
          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>spectrum_config.f90
    <small>Source File</small>
    
    </h1>
	 
<div class="row">
<div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
    <li><i class="fa fa-code"></i><a href="../src/spectrum_config.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li class="active">spectrum_config.f90</li>
  </ol>
</div>
</div>
</div>
    
  </div>
  <div class="row">
    <div class="col-lg-3">
    
<div id="sidebar">
  
  
  
  
  
  
  
  <div class="panel panel-primary">
    <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods">Modules</a></h3></div>
    <div id="mods" class="panel-collapse collapse">
        <div class="list-group">
          
          <a class="list-group-item" href="../module/spectrum_config.html">spectrum_config</a>
          
        </div>
    </div>
  </div>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <div class="panel panel-primary">
    <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
    <div class="list-group">
      <a class="list-group-item" href="../sourcefile/spectrum_config.f90.html#src">spectrum_config.f90</a>
    </div>
  </div>
  
  <hr>
  
  <div class="panel panel-default">
    <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allfiles">All Source Files</a></h3></div>
    <div id="allfiles" class="panel-collapse collapse">
        <div class="list-group">
          
          <a class="list-group-item" href="../sourcefile/analysis_config.f90.html">analysis_config.f90</a>
          
          <a class="list-group-item" href="../sourcefile/bulk_internal_energy.f90.html">bulk_internal_energy.f90</a>
          
          <a class="list-group-item" href="../sourcefile/calc_agyrotropy.f90.html">calc_agyrotropy.f90</a>
          
          <a class="list-group-item" href="../sourcefile/cla_test.f90.html">cla_test.f90</a>
          
          <a class="list-group-item" href="../sourcefile/commandline_arguments.f90.html">commandline_arguments.f90</a>
          
          <a class="list-group-item" href="../sourcefile/compression.f90.html">compression.f90</a>
          
          <a class="list-group-item" href="../sourcefile/compression_shear.f90.html">compression_shear.f90</a>
          
          <a class="list-group-item" href="../sourcefile/current_densities.f90.html">current_densities.f90</a>
          
          <a class="list-group-item" href="../sourcefile/dissipation.f90.html">dissipation.f90</a>
          
          <a class="list-group-item" href="../sourcefile/electric_field.f90.html">electric_field.f90</a>
          
          <a class="list-group-item" href="../sourcefile/emfields.f90.html">emfields.f90</a>
          
          <a class="list-group-item" href="../sourcefile/fieldline_tracing.f90.html">fieldline_tracing.f90</a>
          
          <a class="list-group-item" href="../sourcefile/file_header.f90.html">file_header.f90</a>
          
          <a class="list-group-item" href="../sourcefile/get_info.f90.html">get_info.f90</a>
          
          <a class="list-group-item" href="../sourcefile/get_info_translate.f90.html">get_info_translate.f90</a>
          
          <a class="list-group-item" href="../sourcefile/inductive_efield.f90.html">inductive_efield.f90</a>
          
          <a class="list-group-item" href="../sourcefile/interpolation_emf.f90.html">interpolation_emf.f90</a>
          
          <a class="list-group-item" href="../sourcefile/jdote_eband.f90.html">jdote_eband.f90</a>
          
          <a class="list-group-item" href="../sourcefile/jdote_energy_band.f90.html">jdote_energy_band.f90</a>
          
          <a class="list-group-item" href="../sourcefile/jdote_module.f90.html">jdote_module.f90</a>
          
          <a class="list-group-item" href="../sourcefile/kinds.f90.html">kinds.f90</a>
          
          <a class="list-group-item" href="../sourcefile/magnetic_field.f90.html">magnetic_field.f90</a>
          
          <a class="list-group-item" href="../sourcefile/maximum_energy.f90.html">maximum_energy.f90</a>
          
          <a class="list-group-item" href="../sourcefile/mpi_io_fields.f90.html">mpi_io_fields.f90</a>
          
          <a class="list-group-item" href="../sourcefile/mpi_io_translate.f90.html">mpi_io_translate.f90</a>
          
          <a class="list-group-item" href="../sourcefile/mpi_setup.f90.html">mpi_setup.f90</a>
          
          <a class="list-group-item" href="../sourcefile/neighbors.f90.html">neighbors.f90</a>
          
          <a class="list-group-item" href="../sourcefile/para_perp_pressure.f90.html">para_perp_pressure.f90</a>
          
          <a class="list-group-item" href="../sourcefile/parallel_hdf5.f90.html">parallel_hdf5.f90</a>
          
          <a class="list-group-item" href="../sourcefile/parallel_hdf5.f90%7E2.html">parallel_hdf5.f90</a>
          
          <a class="list-group-item" href="../sourcefile/parallel_potential.f90.html">parallel_potential.f90</a>
          
          <a class="list-group-item" href="../sourcefile/parameters.f90.html">parameters.f90</a>
          
          <a class="list-group-item" href="../sourcefile/parspec.f90.html">parspec.f90</a>
          
          <a class="list-group-item" href="../sourcefile/parspec_cpu_based.f90.html">parspec_cpu_based.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_based_jdote.f90.html">particle_based_jdote.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_drift.f90.html">particle_drift.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_fieldline.f90.html">particle_fieldline.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_fields.f90.html">particle_fields.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_file.f90.html">particle_file.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_frames.f90.html">particle_frames.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_info.f90.html">particle_info.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_module.f90.html">particle_module.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_number_eband.f90.html">particle_number_eband.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_spectrum.f90.html">particle_spectrum.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_spectrum_box.f90.html">particle_spectrum_box.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_spectrum_vdist.f90.html">particle_spectrum_vdist.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_spectrum_vdist_box.f90.html">particle_spectrum_vdist_box.f90</a>
          
          <a class="list-group-item" href="../sourcefile/particle_spectrum_vdist_python.f90.html">particle_spectrum_vdist_python.f90</a>
          
          <a class="list-group-item" href="../sourcefile/path_info.f90.html">path_info.f90</a>
          
          <a class="list-group-item" href="../sourcefile/pressure_tensor.f90.html">pressure_tensor.f90</a>
          
          <a class="list-group-item" href="../sourcefile/read_config.f90.html">read_config.f90</a>
          
          <a class="list-group-item" href="../sourcefile/saving_flags.f90.html">saving_flags.f90</a>
          
          <a class="list-group-item" href="../sourcefile/spectrum_along_fieldline.f90.html">spectrum_along_fieldline.f90</a>
          
          <a class="list-group-item" href="../sourcefile/spectrum_config.f90.html">spectrum_config.f90</a>
          
          <a class="list-group-item" href="../sourcefile/statistics.f90.html">statistics.f90</a>
          
          <a class="list-group-item" href="../sourcefile/topology_translate.f90.html">topology_translate.f90</a>
          
          <a class="list-group-item" href="../sourcefile/translate.f90.html">translate.f90</a>
          
          <a class="list-group-item" href="../sourcefile/translate_config.f90.html">translate_config.f90</a>
          
          <a class="list-group-item" href="../sourcefile/vdist.f90.html">vdist.f90</a>
          
          <a class="list-group-item" href="../sourcefile/vdist_1d_along_fieldline.f90.html">vdist_1d_along_fieldline.f90</a>
          
          <a class="list-group-item" href="../sourcefile/vdist_2d_along_fieldline.f90.html">vdist_2d_along_fieldline.f90</a>
          
          <a class="list-group-item" href="../sourcefile/vdistribution.f90.html">vdistribution.f90</a>
          
        </div>
    </div>
  </div>
  
</div>

    </div>
    <div class="col-lg-9" id='text'>
    <hr>
<p>Module of the initial setup, including the energy bins, the maximum and
 minimum of the particle energy, the energy interval (both linear and
 logarithmic), the center of the box (de), the sizes of the box (cells).</p>
<hr>
    <br>
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><a name="ln-1"></a><span class="c">!*******************************************************************************</span>
<a name="ln-2"></a><span class="c">! Module of the initial setup, including the energy bins, the maximum and</span>
<a name="ln-3"></a><span class="c">! minimum of the particle energy, the energy interval (both linear and</span>
<a name="ln-4"></a><span class="c">! logarithmic), the center of the box (de), the sizes of the box (cells).</span>
<a name="ln-5"></a><span class="c">!*******************************************************************************</span>
<a name="ln-6"></a><span class="k">module </span><span class="nv">spectrum_config</span>
<a name="ln-7"></a>    <span class="k">use </span><span class="nv">constants</span><span class="p">,</span> <span class="nv">only</span><span class="p">:</span> <span class="nv">fp</span><span class="p">,</span> <span class="nv">dp</span>
<a name="ln-8"></a>    <span class="k">implicit none</span>
<a name="ln-9"></a><span class="k">    private</span>
<a name="ln-10"></a><span class="k">    public </span><span class="nv">nbins</span><span class="p">,</span> <span class="nv">emax</span><span class="p">,</span> <span class="nv">emin</span><span class="p">,</span> <span class="nv">dve</span><span class="p">,</span> <span class="nv">dlogve</span><span class="p">,</span> <span class="nv">spatial_range</span><span class="p">,</span> <span class="nv">center</span><span class="p">,</span> <span class="nv">sizes</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-11"></a>           <span class="nv">tot_pic_mpi</span><span class="p">,</span> <span class="nv">pic_mpi_ranks</span><span class="p">,</span> <span class="nv">config_name</span>
<a name="ln-12"></a>    <span class="k">public </span><span class="nv">read_spectrum_config</span><span class="p">,</span> <span class="nv">set_spatial_range_de</span><span class="p">,</span> <span class="nv">calc_pic_mpi_ids</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-13"></a>           <span class="nv">calc_energy_interval</span><span class="p">,</span> <span class="nv">init_pic_mpi_ranks</span><span class="p">,</span> <span class="nv">free_pic_mpi_ranks</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-14"></a>           <span class="nv">calc_pic_mpi_ranks</span>
<a name="ln-15"></a>    <span class="k">public </span><span class="nv">corners_mpi</span><span class="p">,</span> <span class="nv">vmax</span><span class="p">,</span> <span class="nv">vmin</span><span class="p">,</span> <span class="nv">dv</span><span class="p">,</span> <span class="nv">nbins_vdist</span><span class="p">,</span> <span class="nv">tframe</span>
<a name="ln-16"></a>    <span class="k">public </span><span class="nv">calc_velocity_interval</span>
<a name="ln-17"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nbins</span>
<a name="ln-18"></a>    <span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">emax</span><span class="p">,</span> <span class="nv">emin</span><span class="p">,</span> <span class="nv">dve</span><span class="p">,</span> <span class="nv">dlogve</span>
<a name="ln-19"></a>    <span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">vmax</span><span class="p">,</span> <span class="nv">vmin</span><span class="p">,</span> <span class="nv">dv</span>                  <span class="c">! For velocity distribution.</span>
<a name="ln-20"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">nbins_vdist</span>
<a name="ln-21"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">tframe</span>                           <span class="c">! Time frame. </span>
<a name="ln-22"></a>    <span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">center</span>            <span class="c">! In electron skin length (de).</span>
<a name="ln-23"></a>    <span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">sizes</span>             <span class="c">! In number of cells.</span>
<a name="ln-24"></a>    <span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">spatial_range</span>   <span class="c">! In electron skin length (de).</span>
<a name="ln-25"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">corners_mpi</span>      <span class="c">! MPI IDs of the corners.</span>
<a name="ln-26"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">tot_pic_mpi</span>                      <span class="c">! Total number of PIC MPI process.</span>
<a name="ln-27"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">allocatable</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:)</span> <span class="kd">::</span> <span class="nv">pic_mpi_ranks</span>  <span class="c">! PIC MPI rank in 1D.</span>
<a name="ln-28"></a>    <span class="kt">character</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">config_name</span>
<a name="ln-29"></a>
<a name="ln-30"></a>    <span class="k">contains</span>
<a name="ln-31"></a>
<a name="ln-32"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-33"></a>    <span class="c">! Read the setup information from file.</span>
<a name="ln-34"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-35"></a>    <span class="k">subroutine </span><span class="nv">read_spectrum_config</span>
<a name="ln-36"></a>        <span class="k">use </span><span class="nv">mpi_module</span>
<a name="ln-37"></a>        <span class="k">use </span><span class="nv">read_config</span><span class="p">,</span> <span class="nv">only</span><span class="p">:</span> <span class="nv">get_variable</span>
<a name="ln-38"></a>        <span class="k">implicit none</span>
<a name="ln-39"></a><span class="k">        </span><span class="kt">integer</span> <span class="kd">::</span> <span class="nv">fh</span>
<a name="ln-40"></a>        <span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">temp</span>
<a name="ln-41"></a>        <span class="nv">fh</span> <span class="o">=</span> <span class="mi">10</span>
<a name="ln-42"></a>        <span class="k">open</span><span class="p">(</span><span class="nv">unit</span><span class="o">=</span><span class="nv">fh</span><span class="p">,</span> <span class="nv">file</span><span class="o">=</span><span class="nv">config_name</span><span class="p">,</span> <span class="nv">status</span><span class="o">=</span><span class="s1">&#39;old&#39;</span><span class="p">)</span>
<a name="ln-43"></a>        <span class="nv">temp</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;nbins&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>   <span class="c">! Number of energy bins</span>
<a name="ln-44"></a>        <span class="nv">nbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nv">temp</span><span class="p">)</span>
<a name="ln-45"></a>        <span class="nv">emax</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;emax&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>    <span class="c">! Maximum energy</span>
<a name="ln-46"></a>        <span class="nv">emin</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;emin&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>    <span class="c">! Minimum energy</span>
<a name="ln-47"></a>        <span class="nv">center</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;xc/de&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="c">! x-coord of the box center</span>
<a name="ln-48"></a>        <span class="nv">center</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;yc/de&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="c">! y-coord</span>
<a name="ln-49"></a>        <span class="nv">center</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;zc/de&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="c">! z-coord</span>
<a name="ln-50"></a>        <span class="nv">sizes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;xsize&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>  <span class="c">! Number of cells along x</span>
<a name="ln-51"></a>        <span class="nv">sizes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;ysize&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a name="ln-52"></a>        <span class="nv">sizes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;zsize&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a name="ln-53"></a>        <span class="nv">temp</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;nbins_vdist&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a name="ln-54"></a>        <span class="nv">nbins_vdist</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nv">temp</span><span class="p">)</span>
<a name="ln-55"></a>        <span class="nv">vmax</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a name="ln-56"></a>        <span class="nv">vmin</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;vmin&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a name="ln-57"></a>        <span class="nv">temp</span> <span class="o">=</span> <span class="nv">get_variable</span><span class="p">(</span><span class="nv">fh</span><span class="p">,</span> <span class="s1">&#39;tframe&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
<a name="ln-58"></a>        <span class="nv">tframe</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nv">temp</span><span class="p">)</span>
<a name="ln-59"></a>        <span class="k">close</span><span class="p">(</span><span class="nv">fh</span><span class="p">)</span>
<a name="ln-60"></a>
<a name="ln-61"></a>        <span class="k">call </span><span class="nv">calc_energy_interval</span>
<a name="ln-62"></a>
<a name="ln-63"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">myid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-64"></a>            <span class="c">! Echo this information</span>
<a name="ln-65"></a>            <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;---------------------------------------------------&quot;</span>
<a name="ln-66"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A)&quot;</span><span class="p">)</span> <span class="s2">&quot; Spectrum and velocity distribution information.&quot;</span>
<a name="ln-67"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,I0)&quot;</span><span class="p">)</span> <span class="s2">&quot; Number of energy bins = &quot;</span><span class="p">,</span> <span class="nv">nbins</span>
<a name="ln-68"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,E14.6,E14.6)&quot;</span><span class="p">)</span> <span class="s2">&quot; Minimum and maximum energy(gamma) = &quot;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-69"></a>                <span class="nv">emin</span><span class="p">,</span> <span class="nv">emax</span>
<a name="ln-70"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,3F6.2)&quot;</span><span class="p">)</span> <span class="s2">&quot; Center of the box (de) = &quot;</span><span class="p">,</span> <span class="nv">center</span>
<a name="ln-71"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,3F10.2)&quot;</span><span class="p">)</span> <span class="s2">&quot; Sizes of the box (cells) = &quot;</span><span class="p">,</span> <span class="nv">sizes</span>
<a name="ln-72"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,I0)&quot;</span><span class="p">)</span> <span class="s2">&quot; Number of velocity bins = &quot;</span><span class="p">,</span> <span class="nv">nbins_vdist</span>
<a name="ln-73"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,F6.2,F6.2)&quot;</span><span class="p">)</span> <span class="s2">&quot; Minimum and maximum velocity(gamma) = &quot;</span><span class="p">,</span> <span class="p">&amp;</span>
<a name="ln-74"></a>                <span class="nv">vmin</span><span class="p">,</span> <span class="nv">vmax</span>
<a name="ln-75"></a>            <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="s2">&quot;(A,I0)&quot;</span><span class="p">)</span> <span class="s2">&quot; Time frame of velocity distribution = &quot;</span><span class="p">,</span> <span class="nv">tframe</span>
<a name="ln-76"></a>            <span class="k">print</span> <span class="o">*</span><span class="p">,</span> <span class="s2">&quot;---------------------------------------------------&quot;</span>
<a name="ln-77"></a>        <span class="k">endif</span>
<a name="ln-78"></a>
<a name="ln-79"></a><span class="k">    end subroutine </span><span class="nv">read_spectrum_config</span>
<a name="ln-80"></a>
<a name="ln-81"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-82"></a>    <span class="c">! Calculate the energy interval for each energy bin.</span>
<a name="ln-83"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-84"></a>    <span class="k">subroutine </span><span class="nv">calc_energy_interval</span>
<a name="ln-85"></a>        <span class="k">implicit none</span>
<a name="ln-86"></a><span class="k">        </span><span class="nv">dve</span> <span class="o">=</span> <span class="nv">emax</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">nbins</span><span class="p">)</span>  <span class="c">! Linear-scale interval</span>
<a name="ln-87"></a>        <span class="nv">dlogve</span> <span class="o">=</span> <span class="p">(</span><span class="nv">log10</span><span class="p">(</span><span class="nv">emax</span><span class="p">)</span><span class="o">-</span><span class="nv">log10</span><span class="p">(</span><span class="nv">emin</span><span class="p">))</span><span class="o">/</span><span class="kt">real</span><span class="p">(</span><span class="nv">nbins</span><span class="p">)</span>  <span class="c">! Logarithmic-scale.</span>
<a name="ln-88"></a>    <span class="k">end subroutine </span><span class="nv">calc_energy_interval</span>
<a name="ln-89"></a>
<a name="ln-90"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-91"></a>    <span class="c">! Calculate velocity integral.</span>
<a name="ln-92"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-93"></a>    <span class="k">subroutine </span><span class="nv">calc_velocity_interval</span>
<a name="ln-94"></a>        <span class="k">implicit none</span>
<a name="ln-95"></a><span class="k">        </span><span class="nv">dv</span> <span class="o">=</span> <span class="p">(</span><span class="nv">vmax</span> <span class="o">-</span> <span class="nv">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="nv">nbins_vdist</span>
<a name="ln-96"></a>    <span class="k">end subroutine </span><span class="nv">calc_velocity_interval</span>
<a name="ln-97"></a>
<a name="ln-98"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-99"></a>    <span class="c">! Initialize the pic_mpi_ranks 1D array.</span>
<a name="ln-100"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-101"></a>    <span class="k">subroutine </span><span class="nv">init_pic_mpi_ranks</span>
<a name="ln-102"></a>        <span class="k">implicit none</span>
<a name="ln-103"></a><span class="k">        allocate</span><span class="p">(</span><span class="nv">pic_mpi_ranks</span><span class="p">(</span><span class="nv">tot_pic_mpi</span><span class="p">))</span>
<a name="ln-104"></a>        <span class="nv">pic_mpi_ranks</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-105"></a>    <span class="k">end subroutine </span><span class="nv">init_pic_mpi_ranks</span>
<a name="ln-106"></a>
<a name="ln-107"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-108"></a>    <span class="c">! Calculate the pic_mpi_ranks 1D array.</span>
<a name="ln-109"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-110"></a>    <span class="k">subroutine </span><span class="nv">calc_pic_mpi_ranks</span>
<a name="ln-111"></a>        <span class="k">use </span><span class="nv">picinfo</span><span class="p">,</span> <span class="nv">only</span><span class="p">:</span> <span class="nv">domain</span>
<a name="ln-112"></a>        <span class="k">implicit none</span>
<a name="ln-113"></a><span class="k">        </span><span class="kt">integer</span> <span class="kd">::</span> <span class="nv">i</span><span class="p">,</span> <span class="nv">j</span><span class="p">,</span> <span class="nv">k</span><span class="p">,</span> <span class="nv">tx</span><span class="p">,</span> <span class="nv">ty</span><span class="p">,</span> <span class="nv">tz</span><span class="p">,</span> <span class="nv">index1</span>
<a name="ln-114"></a>        <span class="nv">tx</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_tx</span>
<a name="ln-115"></a>        <span class="nv">ty</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_ty</span>
<a name="ln-116"></a>        <span class="nv">tz</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_tz</span>
<a name="ln-117"></a>        <span class="nv">index1</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-118"></a>        <span class="k">do </span><span class="nv">k</span> <span class="o">=</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<a name="ln-119"></a>            <span class="k">do </span><span class="nv">j</span> <span class="o">=</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a name="ln-120"></a>                <span class="k">do </span><span class="nv">i</span> <span class="o">=</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-121"></a>                    <span class="nv">index1</span> <span class="o">=</span> <span class="nv">index1</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-122"></a>                    <span class="nv">pic_mpi_ranks</span><span class="p">(</span><span class="nv">index1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">i</span> <span class="o">+</span> <span class="nv">j</span><span class="o">*</span><span class="nv">tx</span> <span class="o">+</span> <span class="nv">k</span><span class="o">*</span><span class="nv">tx</span><span class="o">*</span><span class="nv">ty</span>
<a name="ln-123"></a>                <span class="nv">enddo</span>
<a name="ln-124"></a>            <span class="nv">enddo</span>
<a name="ln-125"></a>        <span class="nv">enddo</span>
<a name="ln-126"></a>    <span class="k">end subroutine </span><span class="nv">calc_pic_mpi_ranks</span>
<a name="ln-127"></a>
<a name="ln-128"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-129"></a>    <span class="c">! Free the pic_mpi_ranks 1D array.</span>
<a name="ln-130"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-131"></a>    <span class="k">subroutine </span><span class="nv">free_pic_mpi_ranks</span>
<a name="ln-132"></a>        <span class="k">implicit none</span>
<a name="ln-133"></a><span class="k">        deallocate</span><span class="p">(</span><span class="nv">pic_mpi_ranks</span><span class="p">)</span>
<a name="ln-134"></a>    <span class="k">end subroutine </span><span class="nv">free_pic_mpi_ranks</span>
<a name="ln-135"></a>
<a name="ln-136"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-137"></a>    <span class="c">! As the xsize, ysize, zsize are in number of cell, we shall set the spatial</span>
<a name="ln-138"></a>    <span class="c">! range in electron skin length (de).</span>
<a name="ln-139"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-140"></a>    <span class="k">subroutine </span><span class="nv">set_spatial_range_de</span>
<a name="ln-141"></a>        <span class="k">use </span><span class="nv">picinfo</span><span class="p">,</span> <span class="nv">only</span><span class="p">:</span> <span class="nv">domain</span>
<a name="ln-142"></a>        <span class="k">implicit none</span>
<a name="ln-143"></a><span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="nv">fp</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">dx</span><span class="p">,</span> <span class="nv">dy</span><span class="p">,</span> <span class="nv">dz</span><span class="p">,</span> <span class="nv">lx</span><span class="p">,</span> <span class="nv">ly</span><span class="p">,</span> <span class="nv">lz</span>
<a name="ln-144"></a>        <span class="nv">dx</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">dx</span>
<a name="ln-145"></a>        <span class="nv">dy</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">dy</span>
<a name="ln-146"></a>        <span class="nv">dz</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">dz</span>
<a name="ln-147"></a>        <span class="nv">lx</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">lx_de</span>
<a name="ln-148"></a>        <span class="nv">ly</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">ly_de</span>
<a name="ln-149"></a>        <span class="nv">lz</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">lz_de</span>
<a name="ln-150"></a>        <span class="c">! x</span>
<a name="ln-151"></a>        <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span>
<a name="ln-152"></a>        <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nv">dx</span>
<a name="ln-153"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.0</span>
<a name="ln-154"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">lx</span><span class="p">)</span> <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">lx</span>
<a name="ln-155"></a>        <span class="c">! y</span>
<a name="ln-156"></a>        <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span>
<a name="ln-157"></a>        <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="nv">dy</span>
<a name="ln-158"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nv">ly</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="nv">ly</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-159"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">ly</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">ly</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-160"></a>        <span class="c">! z</span>
<a name="ln-161"></a>        <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span>
<a name="ln-162"></a>        <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="nv">dz</span>
<a name="ln-163"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="nv">lz</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="nv">lz</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-164"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">lz</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="nv">spatial_range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">lz</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-165"></a>    <span class="k">end subroutine </span><span class="nv">set_spatial_range_de</span>
<a name="ln-166"></a>
<a name="ln-167"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-168"></a>    <span class="c">! Calculate the IDs of the MPI processes which contains the bottom-left</span>
<a name="ln-169"></a>    <span class="c">! and top-right corners of the box. The MPI processes are in the MPI</span>
<a name="ln-170"></a>    <span class="c">! topology of the PIC simulation.</span>
<a name="ln-171"></a>    <span class="c">!---------------------------------------------------------------------------</span>
<a name="ln-172"></a>    <span class="k">subroutine </span><span class="nv">calc_pic_mpi_ids</span>
<a name="ln-173"></a>        <span class="k">use </span><span class="nv">picinfo</span><span class="p">,</span> <span class="nv">only</span><span class="p">:</span> <span class="nv">domain</span>
<a name="ln-174"></a>        <span class="k">implicit none</span>
<a name="ln-175"></a><span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="nv">dp</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">cx</span><span class="p">,</span> <span class="nv">cy</span><span class="p">,</span> <span class="nv">cz</span>
<a name="ln-176"></a>        <span class="nv">cx</span> <span class="o">=</span> <span class="nv">center</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">idx</span>
<a name="ln-177"></a>        <span class="nv">cy</span> <span class="o">=</span> <span class="p">(</span><span class="nv">center</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">ly_de</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">idy</span>
<a name="ln-178"></a>        <span class="nv">cz</span> <span class="o">=</span> <span class="p">(</span><span class="nv">center</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">lz_de</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">idz</span>
<a name="ln-179"></a>        <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">((</span><span class="nv">cx</span><span class="o">-</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nv">domain</span><span class="p">%</span><span class="nv">pic_nx</span><span class="p">)</span>
<a name="ln-180"></a>        <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">((</span><span class="nv">cy</span><span class="o">-</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nv">domain</span><span class="p">%</span><span class="nv">pic_ny</span><span class="p">)</span>
<a name="ln-181"></a>        <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">((</span><span class="nv">cz</span><span class="o">-</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nv">domain</span><span class="p">%</span><span class="nv">pic_nz</span><span class="p">)</span>
<a name="ln-182"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-183"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-184"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-185"></a>
<a name="ln-186"></a>        <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">((</span><span class="nv">cx</span><span class="o">+</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nv">domain</span><span class="p">%</span><span class="nv">pic_nx</span><span class="p">)</span>
<a name="ln-187"></a>        <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">((</span><span class="nv">cy</span><span class="o">+</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nv">domain</span><span class="p">%</span><span class="nv">pic_ny</span><span class="p">)</span>
<a name="ln-188"></a>        <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nb">floor</span><span class="p">((</span><span class="nv">cz</span><span class="o">+</span><span class="nv">sizes</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="nv">domain</span><span class="p">%</span><span class="nv">pic_nz</span><span class="p">)</span>
<a name="ln-189"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_tx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_tx</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-190"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_ty</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_ty</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-191"></a>        <span class="k">if</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_tz</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="nv">domain</span><span class="p">%</span><span class="nv">pic_tz</span><span class="o">-</span><span class="mi">1</span>
<a name="ln-192"></a>        <span class="nv">tot_pic_mpi</span> <span class="o">=</span> <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-193"></a>                      <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">&amp;</span>
<a name="ln-194"></a>                      <span class="p">(</span><span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="nv">corners_mpi</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a name="ln-195"></a>    <span class="k">end subroutine </span><span class="nv">calc_pic_mpi_ids</span>
<a name="ln-196"></a>
<a name="ln-197"></a><span class="k">end module </span><span class="nv">spectrum_config</span>
</pre></div>

    </section>
    </div>
  </div>

    <hr>
    <footer>
        <div class="row">
        <div class="col-md-4">&copy; 2016 </div>
	<div class="col-md-4"><span class="text-center"> Fortran Program was developed by </span></div>
        <div class="col-md-4"><span class="pull-right">Documentation generated by <a href="https://github.com/cmacmackin/ford">FORD</a></span></div>
        </div>
        <br>
    </footer>
    </div> <!-- /container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>